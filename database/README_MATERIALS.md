# Materials Management System

This document describes the materials management system for the Ritho application.

## Database Structure

The materials table has the following structure:

```sql
CREATE TABLE materials (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);
```

## Features

### 1. Database Layer
- **Table**: `materials` with auto-incrementing ID, name, and timestamps
- **Triggers**: Automatic `updated_at` timestamp updates
- **Indexes**: Optimized for name searches (case-insensitive)
- **RLS**: Row Level Security enabled for user data protection
- **Constraints**: Unique name constraint and NOT NULL validation

### 2. Backend Services (`lib/supabase.ts`)
- **materialsService**: Complete CRUD operations
  - `getAll()`: Retrieve all materials
  - `getById(id)`: Get specific material
  - `create(material)`: Create new material
  - `update(id, updates)`: Update existing material
  - `delete(id)`: Delete material
  - `checkNameExists(name, excludeId?)`: Check for duplicate names

### 3. Frontend Interface (`app/materiais.tsx`)
- **List View**: Display all materials with creation/update dates
- **Form**: Add/edit materials with validation
- **Actions**: Edit and delete materials with confirmation
- **Responsive**: Dark/light mode support
- **Pull to Refresh**: Refresh material list
- **Empty State**: User-friendly empty state message

### 4. Navigation
- Added to main navigation stack in `app/_layout.tsx`
- Included in home screen menu in `app/(tabs)/index.tsx`
- Accessible via hamburger menu icon

## Usage

1. **Navigate to Materials**: From home screen, tap "Materiais" or use the sidebar menu
2. **Add Material**: Tap the "+" button in the header
3. **Edit Material**: Tap the edit (pencil) icon on any material card
4. **Delete Material**: Tap the delete (trash) icon and confirm
5. **Refresh**: Pull down on the list to refresh

## Data Validation

- Material names are required and cannot be empty
- Duplicate names are prevented (case-insensitive)
- Names are trimmed of whitespace
- Auto-capitalization for consistent formatting

## Examples

Common materials you might add:
- Algodão (Cotton)
- Poliéster (Polyester)
- Lã (Wool)
- Seda (Silk)
- Linho (Linen)
- Viscose
- Elastano (Elastane)
- Nylon

## Database Setup

To create the materials table, run the SQL script:
```bash
database/create_materials_table.sql
```

This script includes:
- Table creation
- Indexes for performance
- RLS policies
- Triggers for automatic timestamps
- Sample data insertion

## Error Handling

The system includes comprehensive error handling:
- Network errors are caught and displayed to users
- Database errors are logged for debugging
- User-friendly error messages
- Graceful fallbacks for failed operations

## Security

- Row Level Security (RLS) enabled
- User authentication required
- Input validation and sanitization
- Protection against duplicate entries
